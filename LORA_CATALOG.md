# ComfyUI 印花提取 LoRA 说明

该文档记录当前托管在仓库内的 LoRA 模型、适配场景、训练集特征以及推荐的正/反向提示词。管理端实时测试面板会根据所选 LoRA 自动切换这些预置 prompt，运营或前端可以依此复核、微调。

| LoRA 文件名 | 场景/材质 | 训练数据/比例 | 默认提示词 | 备注 |
| --- | --- | --- | --- | --- |
| `印花提取-YinHuaTiQu-Qwen-Image-Edit-LoRA_V1.safetensors` | 通用平面/家居/包装 | 保持原图比例 | `PATTERN_EXTRACT_POSITIVE_DEFAULT` | 原图尺寸训练 + “曲面展开/文字像素级/背景复刻”等八项指令 |
| `T-Shirt-1-1.safetensors` | T 恤、卫衣等服饰 | 1:1 展开稿 | `PATTERN_EXTRACT_TSHIRT_PROMPT` | T 恤/卫衣 1:1 数据集，专注褶皱展平与底色取样 |
| `杯子1124.safetensors` | 杯子、保温杯等圆柱面 | 原图比例，360° 展开 | `PATTERN_EXTRACT_CUP_PROMPT` | 圆柱体训练，自动展平 360° 并剥离手柄/高光 |
| `印花提取-毛毯1-1.safetensors` | 毛毯/抱枕（方形） | 1:1 | `PATTERN_EXTRACT_BLANKET_PROMPT` | 方形毛毯/抱枕，默认输出 1:1 |
| `印花提取-毛毯2-1.safetensors` | 毛毯/围巾（横向） | 2:1 | `PATTERN_EXTRACT_BLANKET_PROMPT` | 横向 2:1 围巾/披毯，适合左右长条 |
| `印花提取-毛毯1-2.safetensors` | 毛毯/挂布（纵向） | 1:2 | `PATTERN_EXTRACT_BLANKET_PROMPT` | 纵向 1:2 挂毯/帘布，适合上下长条 |

所有 LoRA 共用同一套反向提示词（`PATTERN_EXTRACT_NEGATIVE_DEFAULT`），覆盖噪点、透视、材质、裁切等常见负面特征。

## 1. 标准通用（全品类）

- **文件名**：`印花提取-YinHuaTiQu-Qwen-Image-Edit-LoRA_V1.safetensors`
- **适用范围**：绝大多数平面/布料/家居软装印花；后续工作流默认选项。
- **推荐正向提示词**：

```
1. 纯平面化处理
彻底消除因载体曲率、褶皱、拉伸、弯曲、折叠或缝合造成的透视、阴影、扭曲、压缩或拉伸。无论载体是圆柱体（杯子）、球面（帽子）、软质织物（毛毯）还是复合曲面（背包），输出均需为完全平坦、无变形的二维图案。

2. 剥离所有非图案本体元素
移除载体结构：衣物轮廓、杯身弧度、拉链、纽扣、缝线、标签、水洗标、提手、杯底、帽檐、填充物等。
移除拍摄环境：背景、模特、支架、反光、投影、污渍、指纹、灰尘、镜头畸变。
移除材质表现：布料纹理、针织孔隙、陶瓷釉面、塑料反光、绒毛颗粒、印刷网点、油墨堆积等一切非设计意图的物理细节。
同时完整保留图案内部的设计性元素（底纹、渐变、水印、装饰线条、色块分层、手绘笔触、做旧纹理等）。

3. 文字像素级还原（最高优先级）
所有文字（含标点、符号、数字、装饰框、引号、特殊字符）必须逐像素还原：字体、字号、字重、字间距、行距、排版位置、旋转角度、对齐方式、颜色值。
禁止任何“优化”行为：不得去模糊、锐化、提亮、去灰或修改对比度/饱和度。若原文存在印刷瑕疵（褪色、边缘晕染、叠印错位、油墨渗透），必须如实保留。输出中文字颜色误差 ≤ 1 个色阶（ΔE < 2）。

4. 构图结构 100% 忠实
所有元素的位置、大小、比例、遮挡关系、环绕逻辑、散点密度、对称轴、中心点等必须与原始设计完全一致。
- 独立构图：保持原始边界、留白与视觉重心。
- 重复/无缝图案：精准识别并提取最小可重复单元（Tile Unit），无缝平铺，禁止接缝错位或断裂。

5. 密度与呼吸感还原
保持原图的视觉节奏：稀疏处不可填充，密集处不可稀释，确保设计的留白与节奏不被破坏。散点、粒子、文字阵列的随机性或规律性必须原样呈现。

6. 色彩空间与艺术风格锁定
保持原始色彩配置文件及色彩表现：饱和度、明暗过渡、色彩层次、渐变平滑度均不得改动。保留原始艺术风格（手绘、矢量、丝网印刷、喷墨、水彩、像素风、做旧、荧光等），禁止自动风格迁移或后期增强。

7. 背景色必须 100% 还原载体底色
输出背景必须为纯色，且颜色严格对应原物品未被图案覆盖的基底色。禁止使用透明、白色或默认灰色。需从多个未覆盖区域取样（边缘、背面、空白区）求平均或主导色。允许误差 ≤ 1 色阶。

8. 严禁添加或删减任何内容
禁止新增边框、水印、Logo、版权信息、说明文字等；禁止裁切核心主体；禁止拼接或凭空补全。
```

- **推荐反向提示词**：`PATTERN_EXTRACT_NEGATIVE_DEFAULT`

## 2. T 恤 / 服饰（1:1）

- **文件名**：`T-Shirt-1-1.safetensors`
- **训练集**：标准 1:1 展开稿，覆盖常见面料/字体案例。
- **正向提示词**：与 `PATTERN_EXTRACT_TSHIRT_PROMPT` 一致（见常量文件）；核心强调服饰结构剥离、文字像素级还原与底色复刻。
- **使用建议**：适配 T 恤、卫衣、POLO、运动衫等平铺场景，输出后可直接送入 AI/PS/CDR 排版。

完整文案：

```
核心原则：
1. 纯平面化处理：彻底消除因 T 恤褶皱、肩部弧度、袖口弯曲、下摆拉伸造成的透视、阴影或形变。
2. 剥离所有非印花元素：移除领口、袖口、下摆、缝线、标签、水洗标、纽扣，以及拍摄背景、模特、光照反射、污渍等。
3. 移除物理材质纹理：去除布料网格、棉质颗粒、针织纹路、油墨反光、印刷网点等物理干扰，但保留印花内的设计底纹、渐变、水印、装饰线条、色块分层。

文字必须像素级还原：
- 字体、字号、字重、字间距、行距、排版位置、颜色值完全一致。
- 禁止色彩校正、锐化、提亮或对比度调整；原有褪色、模糊、叠印均需保留。
- 输出中文字颜色误差 ≤ 1 个色阶（ΔE < 2）。

构图结构 100% 忠实：
- 独立构图必须保留原始边界与对称性。
- 重复式/散点式图案需提取最小重复单元并无缝平铺。
- 严格保持原始密度与留白，禁止过度填充或稀释。

背景色 100% 还原：
- 背景必须与原 T 恤面料底色完全一致（误差 ≤ 1 色阶）。
- 禁止透明/白色/默认背景，需通过取色工具从未覆盖区域取样。
- 背景为均匀纯色，无渐变、噪点或纹理。

特别强调：
- 禁止新增任何元素，禁止裁切核心主体。
- 最终输出为干净平面图案 + 纯色背景，可直接用于印刷制版。
```

## 3. 杯子 / 圆柱体

- **文件名**：`杯子1124.safetensors`
- **适用范围**：杯子、保温杯、马克杯、圆柱类包装。
- **正向提示词**：`PATTERN_EXTRACT_CUP_PROMPT`，见常量文件。
- **提示**：高度依赖背景色精确还原，建议提交 360° 环绕或多视角素材验证。

## 4. 毛毯 / 挂布系列

三款毛毯 LoRA（1:1 / 2:1 / 1:2）共用 `PATTERN_EXTRACT_BLANKET_PROMPT`，区别仅在训练比例与默认输出尺寸。简要说明：

- `印花提取-毛毯1-1.safetensors`：正方形展开，适合抱枕、桌布。
- `印花提取-毛毯2-1.safetensors`：横向长条，适合围巾、沙发披毯。
- `印花提取-毛毯1-2.safetensors`：纵向长条，适合挂毯、帘布。

完整 prompt：

```
目标：从实物毛毯照片中提取表面印花，生成可直接用于印刷/打版的 100% 忠实平面设计稿，包含与原毛毯面料底色完全一致的纯色背景。

核心原则：
1. 纯平面化处理
   消除因手持、折叠、悬挂或铺开造成的透视倾斜、边缘卷曲、鼓包、拉伸变形和阴影遮挡，将印花区域展平为无三维形变的二维平面。
2. 剥离所有非印花元素
   移除毛毯轮廓、流苏、缝线、标签、拉链、纽扣等硬件，清除人物、背景家具、光照反射、污渍、褶皱投影，严禁保留任何残影。
3. 移除物理材质纹理
   去除绒毛、针织纹、压花纹、织物网格、反光点、毛边等物理干扰，但需保留木纹、水彩、渐变、装饰线条等设计性元素。

文字 100% 精准还原：
- 中文/英文/符号逐字逐形还原，不得替换、省略或自动纠错。
- 模糊、断笔、墨迹不均需保留原貌。
- 排版结构（行距、字距、对齐、换行、缩进）与原图完全一致。

背景色必须 100% 还原：
- 从未被印花覆盖的区域采样底色（边缘、角落、背面等），填充整个画布。
- 背景为均匀纯色，无渐变、噪点或纹理；允许误差 ≤ 1 色阶。

特别强调：
- 禁止新增元素或裁切核心主体（文字、边框、图标等）。
- 输出格式建议为 PNG（纯色背景、300 DPI 以上）或带出血线的 TIFF/PDF，可直接交付印刷厂。
```

## 5. 反向提示词（全局通用）

```
低分辨率, 模糊, 像素化, 有噪点, 有水印, 有文字, 有边框, 有阴影, 有折痕, 有污渍, 有磨损, 有划痕, 有毛刺, 有锯齿, 有压缩痕迹, 有伪影, 有变形, 有拉伸, 有透视畸变, 有透视效果, 有3D渲染感, 有立体感, 有厚度, 有深度, 有光照, 有反射, 有人物, 有手脚, 有鞋子, 有地板, 有背景, 有家具, 有物品, 有拉链, 有扣子, 有缝线, 有带子, 有边缘, 有裁切, 有不完整图案, 有拼接痕迹, 有重复块状感, 有马赛克, 有卡通风格, 有写实风格, 有油画风格, 有水彩风格, 有手绘感, 有草稿感, 有涂鸦感, 有抽象感, 有现代感, 有极简主义, 有留白, 有空隙, 有空白区域, 有产品轮廓, 有杯口, 有瓶盖, 有液体, 有冰块, 有倾倒效果, 有褶皱, 有布料纹理, 有弯曲弧度, 有曲面变形, 有材质颗粒感, 有织物网格, 有塑料反光, 有金属光泽, 色彩过饱和, 色彩失真, 色彩偏移, 背景变为纯白色, 背景变为纯黑色, 过度锐化, 过度模糊, 风格化处理, 添加新元素, 删除原图元素, 切割核心主体, 重复核心主体, 变形核心主体, 打乱构图关系, 元素前后关系错误, 元素位置错乱, 错误地将独立构图图案进行无缝平铺, 错误地将无缝图案添加边框, 破坏中心对称性, 扭曲图案比例, 可见的拼接痕迹, 垂直方向拼接失败, 水平方向拼接失败, 重复单元边界明显, 图案断层, 错误识别最小重复单元, 单元对齐错误, 图案元素在单元边界处被切断, 单元内图案不完整, 破坏边框完整性, 边框被错误平铺, 中心对称性被破坏, 图案比例失调, 移除设计性背景底纹, 移除水印, 破坏背景层次感, 背景变为纯色, 移除产品结构, 移除功能部件, 破坏产品结构完整性, 功能部件被错误移除, 破坏视觉结构, 忽略设计意图, 结构混乱, 层次不清, 失去渐变效果, 失去分层效果, 视觉焦点错误, 元素密度失衡, 分布规律错误, 过度填充, 元素过于密集, 失去呼吸感, 失去手绘韵味, 元素分布均匀化, 元素分布僵硬
```

> 若新增 LoRA，请在 `backend/app/constants/abilities.py` 中补充 `PATTERN_EXTRACT_LORA_PRESETS` 同时更新本文档，并在 PR 描述中附带样例图/提示词，以便测试与运营复核。
