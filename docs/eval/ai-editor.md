# AI 图片编辑器（评测端）

> 目标：在评测端提供“标注 + 提示词重组”的可视化编辑能力，面向业务同学快速验证图片编辑效果。

## 1. 适用工作流

- workflow_id：`7604714915110060032`
- 用途：KIE Nano Banana Pro 图生图编辑（支持多参考图 + 标注意图）
- 输出：回调 task id（需通过 `/api/coze/podi/tasks/get` 查询最终图片）

## 2. 输入字段

- `url`（必填）：主图 URL
- `prompt`（必填）：提示词（支持 `@标注` 和 `#参考图`）
- `image_urls`（可选）：参考图 URL 列表，**英文逗号分隔**
- `output_format`（可选）：png/jpg/webp
- `aspect_ratio`（可选）：auto/1:1/4:3/3:4/16:9/9:16
- `resolution`（可选）：1K/2K/4K

## 3. 标注能力与命名

支持以下标注方式：

- 点选
- 矩形框选
- 圆形框选
- 手绘

系统会按创建顺序为每个标注自动命名：`标注1 / 标注2 / ...`，并在提示词中以 `@标注1` 的形式引用。

## 4. 参考图编号

参考图按上传顺序编号为 `#1 / #2 / #3 ...`。在提示词中使用 `#1` 即可指代对应参考图。

`image_urls` 的传参规则：

```
<url1>,<url2>,<url3>
```

## 5. 提示词重组方法（核心）

评测端会将用户输入与标注信息 **自动拼接**，最终发送给 Coze 的 `prompt` 格式为：

```
【用户指令】
<用户输入的提示词>

【标注说明】
@标注1（矩形）：left=120(0.12), top=80(0.08), width=240(0.24), height=60(0.06)
@标注2（点）：x=512(0.50), y=360(0.45)
@标注3（圆形）：cx=300(0.30), cy=400(0.40), r=100(0.10)
@标注4（手绘）：bbox=[10(0.01),20(0.02)]-[200(0.20),120(0.15)] points=(...)

【参考图】
#1: https://...
#2: https://...

【原图尺寸】
width=1000, height=800
```

> 说明：坐标为 **原图像素坐标**，括号内为比例（0~1）。

## 6. 示例（业务场景）

场景：上传一张圣诞主题图，框选 “Merry Christmas” 文案，并把它改成 “新年快乐”；
点选圣诞老人，并要求“参考图 #1 的人物形象”。

提示词示例：

```
@标注1 把这段文字改成“新年快乐”，字体风格参考 #1
@标注2 保持圣诞老人姿势不变，但脸部参考 #1
```

## 7. 接入建议

- 业务侧如需直接接入，请 **复制评测端的提示词拼接策略**。
- 标注必须与提示词中的 `@标注X` 保持一致。
- 参考图若为空，则不传 `image_urls`。

## 8. 常见问题

- **提示词为空时报错 `PROMPT_REQUIRED`**：`prompt` 为必填字段。
- **成功但无图**：先检查 `/api/coze/podi/tasks/get` 是否返回 `imageUrls`。

---

如需修改重组策略或字段格式，请同步更新本文档。
