# 问题与优化记录（滚动）

> 目的：梳理真实问题与可优化项，避免遗忘与反复踩坑。  
> 规则：只记录“已观察/已复现”的问题；不做大重构建议，优先可控与低风险改进。

## 记录格式（建议）

- 日期：
- 范围（平台/模块）：
- 现象：
- 影响：
- 根因（已知/待确认）：
- 建议改进：
- 状态（未开始/处理中/已完成）：

---

## 2026-02-03

1) **参数契约不一致（url/Url）**
- 范围：评测平台 / Coze 工作流
- 现象：Coze 报缺参 `Missing required parameters: 'url'`
- 影响：工作流无法执行，评测与业务接入受阻
- 根因：评测/文档字段与 Coze 工作流参数未同步
- 改进：统一 `url` 为图片入参，并将契约写入文档（已执行）
- 状态：处理中（需持续验证）

2) **回调 taskId 查不到（TASK_NOT_FOUND）**
- 范围：Coze 回调 / `/api/coze/podi/tasks/get`
- 现象：回调工作流执行失败，返回 TASK_NOT_FOUND
- 影响：回调链路不可用，业务无法获取结果
- 根因：可能是环境/数据库不一致，或任务未落库
- 改进：确认 Coze 与后端是否同环境；回调前先确认任务落库
- 状态：待确认

3) **Coze schema 缓存导致字段不更新**
- 范围：Coze 工具箱 / Workflow 节点
- 现象：字段更新后仍显示旧 schema
- 影响：业务侧误填、难排查
- 根因：Coze 节点缓存旧 schema
- 改进：重新导入工具箱或删除节点重建
- 状态：常规注意项

4) **OSS 环境变量切换后展示异常**
- 范围：OSS 上传/预览
- 现象：上传成功但展示失败、链接不可用
- 影响：评测/管理端无法预览结果
- 根因：环境变量未同步/未验证读写
- 改进：补充 OSS 切换 Checklist（读写验证）
- 状态：待完善

5) **网络抖动导致页面转圈**
- 范围：前端请求体验
- 现象：请求无超时提示，页面卡住
- 影响：用户体验差，难排查
- 根因：前端无统一超时提示（保守策略待定）
- 改进：保持低风险处理（例如仅记录问题与培训排查）
- 状态：观察中

6) **评测页面 EVAL_PUBLIC_TOKEN 未内置 Header**
- 范围：评测平台
- 现象：开启 `EVAL_PUBLIC_TOKEN` 后，前端请求无 token
- 影响：评测页面 401
- 根因：前端未自动附加 `X-Eval-Token`
- 改进：通过 URL `?token=...` 注入或后续补充 header
- 状态：记录

7) **评测轮询频率固定 2s**
- 范围：评测平台
- 现象：运行列表与任务列表每 2s 请求一次
- 影响：高频请求可能增加后端压力
- 根因：固定轮询，无动态退避
- 改进：后续可按任务数量/状态动态降频
- 状态：记录

8) **文档字段示例与实际接口不一致**
- 范围：Coze 对接指南
- 现象：文档出现示例域名/旧路径（如 `/api/ability_tasks`）
- 影响：业务方照文档调用失败
- 根因：历史模板未同步更新
- 改进：统一为当前路径与实际部署地址
- 状态：处理中

9) **Coze 工具箱输出字段缺失**
- 范围：Coze 工具箱
- 现象：工作流节点看不到返回字段
- 影响：业务无法拿到结果/调试信息
- 根因：OpenAPI schema 未声明输出字段
- 改进：更新插件 OpenAPI 后重新发布；删除节点重建
- 状态：记录
