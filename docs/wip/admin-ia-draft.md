# 管理端信息架构草案（WIP）

> 目标：先把“大框架”搭出来，即使当前内容未完善也要预留位置，方便后续按节奏回顾优化。本文梳理导航、页面结构、已有能力如何逐步嵌入，以及命名规范。

---

## 顶层导航（最终形态）

| 导航 | 角色 | 说明 / 预留内容 |
| --- | --- | --- |
| **能力目录** | 原子能力中心 | 列表（能力、厂商、状态、成本、最近自检、默认执行节点） + 详情（Schema、默认参数、Metadata、文档、成本/SLA、自检结果） + “测试”Tab（沿用现有测试面板）。 |
| **执行节点**（接入点） | 运行资源 | 列表展示 node 名称、类型、状态、权重、绑定能力数、最近心跳；详情包含 base_url、并发、权重、标签、健康历史、关联能力。 |
| **能力调用记录** | 可观测性 | 全局日志页：过滤器（能力/来源/时段/节点）、表格（时间、能力、来源、节点、耗时、成本、结果/错误、requestId），侧栏显示请求/响应；支持导出。 |
| **工作流编排** | 业务流程 | 未来真正的 Workflow Builder：流程列表（名称、版本、状态）、可视化 DAG 编辑器、运行列表与节点 Trace。当前 ComfyUI JSON 迁至“模板”子标签。 |
| **调度与监控** | 运维 | Dashboard（任务队列、执行器健康、能力自检状态、成本汇总）、调度事件日志（Task logs）、告警配置。 |
| **系统配置** | 基础设施 | OSS、数据库、鉴权、向量库、积分等配置项。 |

> 备注：导航数量不必全部立即实现，但侧栏先预留这些入口（可以标记 “Coming soon”），便于大家知道最终目标。

---

## 页面级结构（以能力目录为例）

```
能力目录
├─ 顶部指标（能力总数、活跃执行器、今日调用、成本）
├─ 主表（可筛选/排序）
│    列：名称、厂商、类别、状态、默认节点、成本、最近自检、操作
├─ 详情抽屉（Tabs）
│    1. 概览：描述、标签、成本、SLA、自检历史
│    2. 输入参数：默认参数、Schema（节点编号说明）、参考图片
│    3. 元数据：metadata JSON（能力ID、workflow_key、pricing等）
│    4. 测试：沿用 “能力测试” 表单 + 结果 + 最近调用记录
│    5. 调用记录：当前能力的历史日志（引用 global log 组件）
└─ 占位块：如果某部分暂未实现，可显示 “TODO：xxx” 说明，避免空白
```

同理，其他页面也应预留“二级结构 + 占位说明”，即便现在只显示一行文字，也在布局上先放好卡片/Tab。

> 2026-01-13 更新：管理端“能力目录”页面已落地搜索/筛选、Tab 详情（概览/参数/元信息/实时测试/调用记录）以及成本/自检占位卡片；“实时测试”Tab 直接沿用原测试面板，日志 Tab 复用 ability log 组件。

---

## 术语与命名

| 名称 | 推荐用词 | 说明 |
| --- | --- | --- |
| 接入点 | **执行节点（Executor）** | 与 `backend/app/models/integration.py` 中的 `Executor` 一致，避免“接入点/节点”混用。 |
| 工作流 | **业务工作流 / Workflow** | 指由多个原子能力/工具组成的 DAG。当前 ComfyUI 的 workflow JSON 只是“模板文件”，建议在 UI 中叫“ComfyUI 模板”或“图形模板”，与真正的 Workflow 区分。 |
| 原子能力 | **Ability** | 指 API/ComfyUI/KIE 等单一能力。所有页面提到“能力测试/能力日志/能力成本”都指它。 |
| 成本 | **Pricing** | 显式区分 `list_price`（对外价）和 `discount_price`（内部结算价），单位字段 `unit`（per_image/per_call/per_minute…）。 |

---

## 现有功能映射到新结构

| 现状 | 对应新结构 | Action |
| --- | --- | --- |
| `IntegrationDashboard` 中的“能力管理 + 能力测试 + 调度日志” | 拆成“能力目录”“能力调用记录”“调度与监控” | 先在 UI 中增加侧栏入口，并引用同一套组件（列表、日志）以便后续拆页。 |
| ComfyUI workflow JSON CRUD | “工作流编排 > ComfyUI 模板（子 Tab）” | 重命名并注明“此处仅存 ComfyUI workflow graph”，后续 builder 完成后迁移。 |
| Dispatch Logs | “调度与监控 > 调度事件” | 保留位置，但在表格上方加描述“与能力日志不同”。 |
| `ability_log` 的全局展示（新功能） | “能力调用记录” | 目前页面已嵌入在调度日志模块中，下一步抽出来成为独立导航，表结构沿用。 |

---

## 占位策略（即便空白也要有“说明”）

- 在左侧导航中列出全部目标模块；未完成的在内容区域展示说明卡片：“即将支持 [功能]，当前阶段可在 [链接] 预览日志”，确保大家知道此位置将来要放什么。
- 页面中若某指标/卡片尚未实现，也要放一个“空状态”卡片，文字写明 TODO，例如“成本趋势：待接入 ability_cost_snapshots”。

---

## 下一步建议

1. **实现导航占位**：在管理端侧栏按上述结构添加入口，并在页面上放置空态卡片，哪怕暂时只显示说明文案。
2. ✅ **能力目录 → Tab 化**：已将“能力测试”流程迁入“实时测试”Tab，同时新增概览/参数/元信息/日志 Tab、列表筛选与成本列；下一步是把自动自检/成本曲线的数据源接入占位卡片。
3. **重命名工作流区块**：将现有 “工作流管理” 标题换成 “ComfyUI 模板”，并加说明“真正的工作流编排将在此模块上线时呈现”。
4. **定期回顾**：每周或每两周在此文档末尾记录“本次回顾结论/下一步”，形成良性循环。
